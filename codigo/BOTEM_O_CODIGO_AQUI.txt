import pygame
pygame.init()
screen = pygame.display.set_mode((0, 0), pygame.FULLSCREEN)
import Constantes as C
C.screen = screen
import Mapa
import Jogador

def main():
    
    pygame.display.set_caption("ProgramMan")
    clock = pygame.time.Clock()
    font = pygame.font.SysFont('Arial', 50)

    mapa = Mapa.Mapa(C.MAPA_1)

    map_width = C.MAP_X * C.TILE_SIZE
    map_height = C.MAP_Y * C.TILE_SIZE
    offset_x = (C.X_MAX - map_width) // 2
    offset_y = 0
    
    for wall in mapa.get_walls():
        wall.rect.x += offset_x
        wall.rect.y += offset_y
    for pellet in mapa.get_pellets():
        pellet.rect.x += offset_x
        pellet.rect.y += offset_y
    for upgrade in mapa.get_upgrade():
        upgrade.rect.x += offset_x
        upgrade.rect.y += offset_y
    for fruits in mapa.get_fruit():
        fruits.rect.x += offset_x
        fruits.rect.y += offset_y

    jogador = Jogador.Jogador(mapa.player_start[0] + offset_x, mapa.player_start[1] + offset_y, mapa)

    while True:
        for event in pygame.event.get():
            if event.type == pygame.QUIT:
                return
            elif event.type == pygame.KEYDOWN:
                if event.key == pygame.K_ESCAPE:
                    return

        jogador.handle_input()
        jogador.update(1 / C.FPS)

        screen.fill(C.BLACK)
        mapa.get_walls().draw(screen)
        mapa.get_pellets().draw(screen)
        mapa.get_upgrade().draw(screen)
        mapa.get_fruit().draw(screen)
        jogador.draw(screen)

        text_teclas_apertadas = font.render(f"Teclas apertadas: {jogador.score}", True, C.WHITE)
        x = C.X_MAX - text_teclas_apertadas.get_width() - 80 
        y = 20
        screen.blit(text_teclas_apertadas, (x, y))
        
        text_monitores_chamados = font.render(f"Monitores chamados: {jogador.score}", True, C.WHITE)
        x = C.X_MAX - text_monitores_chamados.get_width() - 80 
        y = 40
        screen.blit(text_monitores_chamados, (x, y))

        text_energeticos_consumidos = font.render(f"Energ√©ticos consumidos: {jogador.score}", True, C.WHITE)
        x = C.X_MAX - text_energeticos_consumidos.get_width() - 80 
        y = 60
        screen.blit(text_energeticos_consumidos, (x, y))

        pygame.display.flip()
        clock.tick(C.FPS)

if __name__ == "__main__":
    main() 
